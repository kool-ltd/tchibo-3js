<!DOCTYPE html>
<html>
<!-- [Previous head section remains the same] -->

<script type="module">
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { ARButton } from 'three/addons/webxr/ARButton.js';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // [Previous variable declarations remain the same]
    let modelContainer; // Container for all three parts

    async function loadModels() {
        const loader = new GLTFLoader();
        const REAL_WORLD_LENGTH = 0.045; // 45cm = 0.45m, divided by 10 for smaller scale
        
        // Create a container for all parts
        modelContainer = new THREE.Group();
        
        // Promise-based loading function
        const loadPart = (url) => {
            return new Promise((resolve, reject) => {
                loader.load(url,
                    (gltf) => resolve(gltf.scene),
                    (xhr) => {
                        const percent = xhr.loaded / xhr.total * 100;
                        document.getElementById('loading-text').textContent = 
                            `Loading model... ${Math.round(percent)}%`;
                    },
                    (error) => reject(error)
                );
            });
        };

        try {
            // Load all three parts
            const [leftPart, bodyPart, rightPart] = await Promise.all([
                loadPart('./241218 - tchibo - 4 in 1 rolling pin-L.glb'),
                loadPart('./241218 - tchibo - 4 in 1 rolling pin-body.glb'),
                loadPart('./241218 - tchibo - 4 in 1 rolling pin-R.glb')
            ]);

            // Add parts to container
            modelContainer.add(leftPart);
            modelContainer.add(bodyPart);
            modelContainer.add(rightPart);

            // Scale the entire container
            const bbox = new THREE.Box3().setFromObject(modelContainer);
            const modelSize = bbox.getSize(new THREE.Vector3());
            const scaleFactor = REAL_WORLD_LENGTH / modelSize.z;
            modelContainer.scale.set(scaleFactor, scaleFactor, scaleFactor);

            // Center the container
            bbox.setFromObject(modelContainer);
            const center = bbox.getCenter(new THREE.Vector3());
            modelContainer.position.sub(center);

            // Add preview model
            const previewModel = modelContainer.clone();
            previewModel.position.set(0, 0, 0);
            scene.add(previewModel);

            document.getElementById('loading-text').style.display = 'none';
            console.log('All models loaded successfully');

            // Store the container as the model
            model = modelContainer;

        } catch (error) {
            console.error('Error loading models:', error);
            document.getElementById('loading-text').textContent = 'Error loading models';
        }
    }

    async function init() {
        // [Previous init code remains the same until the model loading section]

        // Replace the previous model loading code with:
        await loadModels();

        // [Rest of the init code remains the same]
    }

    // [Rest of the code remains the same]
</script>
</body>
</html>
